// Generated by CoffeeScript 1.6.3
(function() {
  var firstLine, fs, git, logCommit, main, node_modules, path, readRepo, remoteRepoGroup, root;

  fs = require('fs');

  path = require('path');

  git = require('git-node');

  root = '../voxpopuli';

  remoteRepoGroup = 'deathcap';

  node_modules = path.join(root, 'node_modules');

  main = function() {
    var file, files, p1, p2, p3, projectName, stats, _i, _len, _results;
    files = fs.readdirSync(node_modules);
    console.log(files);
    _results = [];
    for (_i = 0, _len = files.length; _i < _len; _i++) {
      file = files[_i];
      p1 = path.join(node_modules, file);
      stats = fs.lstatSync(p1);
      if (!stats.isSymbolicLink()) {
        continue;
      }
      p2 = fs.readlinkSync(p1);
      p3 = fs.readlinkSync(p2);
      projectName = path.basename(p3);
      readRepo(projectName, p3);
      break;
    }
    return _results;
  };

  readRepo = function(projectName, p3) {
    var repo;
    repo = git.repo(path.join(p3, '.git'));
    return repo.logWalk('HEAD', function(err, log) {
      var onRead;
      if (err) {
        throw err;
      }
      onRead = function(err, commit) {
        if (err) {
          throw err;
        }
        if (!commit) {
          return;
        }
        logCommit(projectName, commit);
        return repo.treeWalk(commit.tree, function(err, tree) {
          var onEntry;
          if (err) {
            throw err;
          }
          onEntry = function(err, entry) {
            if (err) {
              throw err;
            }
            if (!entry) {
              return log.read(onRead);
            }
            return tree.read(onEntry);
          };
          return tree.read(onEntry);
        });
      };
      return log.read(onRead);
    });
  };

  logCommit = function(projectName, commit) {
    return console.log("" + remoteRepoGroup + "/" + projectName + "@" + commit.hash + " " + (firstLine(commit.message)));
  };

  firstLine = function(s) {
    return s.split('\n')[0];
  };

  main();

}).call(this);
